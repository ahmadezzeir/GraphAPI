image: Ubuntu

install:
- pip install --user codecov

before_build:
- dotnet restore

build_script:
- sh: dotnet build

after_build:
- export SONAR_SCANNER_VERSION=4.2.0.1873
- export SONAR_SCANNER_HOME=$HOME/.sonar/sonar-scanner-$SONAR_SCANNER_VERSION-linux
- rm -rf $SONAR_SCANNER_HOME
- mkdir -p $SONAR_SCANNER_HOME
- curl -sSLo $HOME/.sonar/sonar-scanner.zip https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-$SONAR_SCANNER_VERSION-linux.zip
- unzip $HOME/.sonar/sonar-scanner.zip -d $HOME/.sonar/
- rm $HOME/.sonar/sonar-scanner.zip
- export PATH=$SONAR_SCANNER_HOME/bin:$PATH
- export SONAR_SCANNER_OPTS="-server"

- sonar-scanner -Dsonar.projectKey=gbauso_GraphAPI -Dsonar.organization=gbauso -Dsonar.sources=. -Dsonar.host.url=https://sonarcloud.io -Dsonar.login=c9637c6be7788b1eb7c14f14984a08971652bfed

test_script:
- cd test && cd Graph.Tests
- dotnet add package coverlet.msbuild
- dotnet test /p:CollectCoverage=true /p:CoverletOutput=TestResults/ /p:CoverletOutputFormat=lcov
- cd TestResults 
- cd codecov -t '7b7d9ee8-1384-4dc7-a6b8-771cde0fb11a'
